!function(a){"use strict";"function"==typeof define&&define.amd?define([],a):window.bChart=a()}(function(){"use strict";var a={},b=function(c){if(b.existy(c)&&b.typeString(c)){if(2===arguments.length){var d=new b[arguments[1]](arguments[0]);return d}if(1===arguments.length&&b.isSelector(c))return a[c]}};b.getObjectBySelector=function(b){return a[b]},b.setObjectOfSelector=function(b,c){a[b]=c},b.isSelector=function(a){return a.indexOf("#")>=0||a.indexOf(".")>=0},b.clone=function(a){return b.typeObject(a)?JSON.parse(JSON.stringify(a)):void 0},b.generateArray=function(a){for(var b=[],c=0;a>c;c+=1)b.push(c);return b},b.setChart=function(a,b){var c=this;return c[b]=a,c},b.existy=function(a){return null!=a},b.getUniqueValueArray=function(a){return function(c){if(b.existy(c)){var d=[];return b.each(c,function(b,c){d.indexOf(b[a])<0&&d.push(b[a])}),d}}},b.sorted=function(a,b){return a.sort(b)},b.typeDate=function(a){return isNaN(new Date(a).getTime())},b.each=function(a,c,d){if(b.isArrayLike(a))for(var e=b.getLength(a),f=0;e>f;f++)c(a[f],f,a);else for(var g in a)c(a[g],g,a)},b.property=function(a){return function(c){return b.existy(c)?c[a]:void 0}},b.hasProperty=function(a,c){if(b.typeString(c)){if(c.indexOf(".")>=0){var d=c.split(".");return b.existy(a[d[0]][d[1]])}return b.existy(a[c])}},b.setProperty=function(a,c,d){if(b.hasProperty(a,c)&&b.typeString(c))if(c.indexOf(".")>=0){var e=c.split(".");a[e[0]][e[1]]=d}else a[c]=d},b.getLength=b.property("length"),b.isArrayLike=function(a){if(b.typeString(a))return!1;var c=b.getLength(a);return b.typeNumber(c)&&c>=0},b.typeofObject=function(a){return function(b){return a(b)}},b.typeNumber=b.typeofObject(function(a){return!isNaN(a)}),b.typeString=b.typeofObject(function(a){return"string"==typeof a}),b.typeObject=b.typeofObject(function(a){return"object"==typeof a}),b.existy=function(a){return null!=a},b.truthy=function(a){return a!==!1&&b.existy(a)},b.hexToRGBA=function(a,b){var c=a.replace("#",""),d=parseInt(c.substring(0,2),16),e=parseInt(c.substring(2,4),16),f=parseInt(c.substring(4,6),16);return"rgba("+d+","+e+","+f+","+b+")"},b.getIndexOfElement=function(a,c){return b.existy(c)?c.indexOf(a):-1},b.isElementInArray=function(a,c){return b.getIndexOfElement(a,c)>=0},b.concatNoDuplicate=function(a,c){var d=a.concat(c);return d.filter(function(a,c){return b.getIndexOfElement(a,d)===c})},b.removeElementFromArray=function(a,c){return b.isElementInArray(a,c)?(c.splice(b.getIndexOfElement(a,c),1),c):void 0},b.removeArrayFromArray=function(a,c){return a.filter(function(a,d){return!b.isElementInArray(a,c)})},b.isOverlapArray=function(a,c){var d=a.concat(c),e=d.filter(function(a,c){return b.getIndexOfElement(a,d)===c});return d.length!==e.length},b.isSubArray=function(a,c){var d=c.filter(function(c,d){return!b.isElementInArray(c,a)});return d.length>0?!1:!0},b.getSubArray=function(a,c){return b.isSubArray(a,c)?c:c.filter(function(c,d){return b.isElementInArray(c,a)})},b.prototype={options:function(a){var c=this;return b.existy(a)?b.typeString(a)&&1===arguments.length?c._options[a]:(c.setOptions(arguments).draw(),c):c._options},setOptions:function(a,c){var d,e,f=this,g=function(a){return function(c){if(b.existy(c)){var d={};b.typeString(c)?1==arguments.length?d={selector:c}:d[arguments[0]]=arguments[1]:d=c,b.existy(a)?b.typeString(a)&&"_dataset"===a?(b.each(c,function(a,c,d){b.existy(d[c].group)||(d[c].group="")}),f._options[a]=c):b.each(d,function(c,d){b.setProperty(f._options[a],d,c)}):b.each(d,function(a,c){"data"===c?f.load(a):b.setProperty(f._options,c,a)})}}};if(d=b.existy(c)?g(c):g(),b.isArrayLike(a))if(1==a.length){if(!b.typeObject(a[0]))return console.log("Can't update the property!"),f;e=a[0],d(e)}else d(a[0],a[1]);else e=a,d(e);return f},getOptions:function(a){var c=this;return b.existy(a)?b.hasProperty(c._options,a)?c._options[a]:void 0:c.options},min2:function(){var a=this;return b.existy(a._options.min2)?a._options.minDefault2=a._options.min2:a._options.minDefault2=d3.min(a._options._dataset,function(a){return a.secondAxis?parseFloat(a.value):void 0}),a},min:function(){var a=this;return b.existy(a._options.min)?a._options.minDefault=a._options.min:a._options.minDefault=d3.min(a._options._dataset,function(a){return parseFloat(a.value)}),a},max2:function(){var a=this;if(a._options.isStack){var c=[];b.each(a._options._uniqueXArray,function(b,d,e){var f=a._options._dataset.filter(function(a){return b===a.x&&a.secondAxis});c.push(d3.sum(f,function(a){return parseFloat(a.value)}))}),a._options.maxDefault2=d3.max(c)}else b.existy(a._options.max2)?a._options.maxDefault2=a._options.max2:a._options.maxDefault2=d3.max(a._options._dataset,function(a){return a.secondAxis?parseFloat(a.value):void 0});return a},max:function(){var a=this;if(a._options.isStack){var c=[];b.each(a._options._uniqueXArray,function(b,d,e){var f=a._options._dataset.filter(function(a){return b===a.x});c.push(d3.sum(f,function(a){return parseFloat(a.value)}))}),a._options.maxDefault=d3.max(c)}else b.existy(a._options.max)?a._options.maxDefault=a._options.max:a._options.maxDefault=d3.max(a._options._dataset,function(a){return parseFloat(a.value)});return a},updateMin2:function(){var a=this;return b.existy(a._options.max2)||b.existy(a._options.min2)||(a._options.minDefault2-=(a._options.maxDefault2-a._options.minDefault2)/a._options.yAxis2.tickNumber),a},updateMin:function(){var a=this;return b.existy(a._options.max)||b.existy(a._options.min)||(a._options.minDefault-=(a._options.maxDefault-a._options.minDefault)/a._options.yAxis.tickNumber),a},stackDataset:function(a,c,d){var e=d3.layout.stack(),f=e(c.map(function(c){var e=[],f=[];return b.each(a,function(a,b,d){c===d[b].group&&e.push(d[b])}),f=e.filter(function(a,b){return d.indexOf(a.x)>=0}),f.map(function(a){return{x:a.x,value:+parseFloat(a.value),secondAxis:a.secondAxis,y:+parseFloat(a.value),group:a.group}})}));return f},colors:function(a){function c(){var a="";b.each(d._options._uniqueGroupArrayAll,function(c,e){a=d._options.colors[e].indexOf("#")>=0?b.hexToRGBA(d._options.colors[e%d._options.colors.length],d._options.colorOpacity):d._options.colors[e%d._options.colors.length],d._options._colorMap[c]=a})}var d=this;return b.existy(a)&&b.typeString(a)&&"option"===a?d._options.colors:(d.setOptions(arguments),c(),d)},load:function(a){var c=this;return b.existy(a)&&(b.isArrayLike(a)?c.loadArrayData(a):b.typeObject(a)&&c.loadObjectData(a)),d3.select(c._options.selector).select("svg").empty()||(c._options.secondAxis&&c.min2().max2().updateMin2(),c.min().max().updateMin().colors().drawChartSVG().legend().tooltip()),c},loadObjectData:function(a){var c=this;if(b.hasProperty(a,"dataValue")&&(b.hasProperty(a,"groups")&&(a.groups=a.groups.splice(0,a.dataValue.length),c._options._uniqueGroupArrayAll=b.concatNoDuplicate(c._options._uniqueGroupArrayAll,a.groups)),b.hasProperty(a,"x")&&(c._options._uniqueXArray=b.concatNoDuplicate(c._options._uniqueXArray,a.x)),b.hasProperty(a,"groups2")&&a.groups2.length>0&&(c._options.secondAxis=!0,c._options._uniqueGroupArray2=b.concatNoDuplicate(c._options._uniqueGroupArray2,a.groups2),c._options._uniqueGroupArray=b.removeArrayFromArray(c._options._uniqueGroupArrayAll,c._options._uniqueGroupArray2)),b.isArrayLike(a.dataValue)&&b.isArrayLike(a.dataValue[0])&&(b.hasProperty(a,"groups")||!b.typeNumber(a.dataValue[0][0]))))for(var d=0;d<a.dataValue.length;d+=1){var e="";e=b.existy(a.groups)&&b.existy(a.groups[d])?a.groups[d]:b.typeNumber(a.dataValue[d][0])?"unknown":a.dataValue[d][0],b.isElementInArray(e,c._options._uniqueGroupArrayAll)||c._options._uniqueGroupArrayAll.push(e),b.each(a.dataValue[d],function(f,g,h){if(b.typeNumber(a.dataValue[d][g])){var i={x:"",group:e,value:a.dataValue[d][g]};if(b.typeNumber(a.dataValue[d][0]))b.existy(a.x[g])?i.x=a.x[g]:i.x=g;else{if(0===g)return;b.existy(a.x[g-1])?i.x=a.x[g-1]:i.x=g}b.isElementInArray(e,c._options._uniqueGroupArray2)?i.secondAxis=!0:i.secondAxis=!1,c._options._dataset.push(i)}})}},loadArrayData:function(a){}};var c={},d={selector:"",colors:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],colorOpacity:1,barDistance:2,duration:400,padding:{top:80,right:90,bottom:50,left:60},_colorMap:{},_datasetTmp:[],_uniqueGroupTmp:[],_uniqueXArray:[],_uniqueGroupArrayAll:[],_uniqueGroupArray2:[],_dataset:[],minDefault:-1,maxDefault:-1,minDefault2:-1,maxDefault2:-1,width:800,height:350,background:{imageURL:"",color:"#ffffff",displayImage:!1,opacity:1},secondAxis:!1,isStack:!1,legend:{position:"topright",offsetText:5,offsetSymbol:15,symbolSize:10,multipleLine:!1,textFirst:!0,display:!0,fontType:"helvetica",fontSize:12,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontColor:"#000000",offsetAdjust:{horizontal:0,vertical:0}},title:{display:!0,text:"Bar Chart",fontType:"helvetica",fontSize:18,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontColor:"#000000",offsetAdjust:{horizontal:0,vertical:0}},xLabel:{display:!0,text:"x label",rotation:0,fontType:"helvetica",fontSize:14,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontColor:"#000000",offsetAdjust:{horizontal:0,vertical:0}},yLabel:{display:!0,text:"y label",rotation:-90,fontType:"helvetica",fontSize:14,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontColor:"#000000",offsetAdjust:{horizontal:0,vertical:0}},yLabel2:{display:!0,text:"y label second",rotation:-90,fontType:"helvetica",fontSize:14,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontColor:"#000000",offsetAdjust:{horizontal:0,vertical:0}},yAxis:{display:!0,displayLine:!0,tickNumber:8,tickFormat:d3.format(",.0f"),tickPadding:3,tickSize:10,orientation:"left",tickValue:[],fontColor:"#000",fontType:"helvetica",fontSize:12,fontBold:!1,fontItalic:!1,fontUnderline:!1,tickLineColor:"#ccc",tickLineWidth:.2,axisColor:"#000",axisWidth:1,rotation:0,offsetAdjust:{horizontal:0,vertical:0}},yAxis2:{display:!0,displayLine:!1,tickNumber:8,tickFormat:d3.format(",.0f"),tickPadding:3,tickSize:10,orientation:"right",tickValue:[],fontColor:"#000",fontType:"helvetica",fontSize:12,fontBold:!1,fontItalic:!1,fontUnderline:!1,tickLineColor:"#ccc",tickLineWidth:.2,axisColor:"#000",axisWidth:1,rotation:0,offsetAdjust:{horizontal:0,vertical:0}},xAxis:{display:!0,displayLine:!0,tickNumber:5,tickFormat:"",tickPadding:3,tickSize:10,orientation:"bottom",tickValue:[],fontColor:"#000",fontType:"helvetica",fontSize:12,fontBold:!1,fontItalic:!1,fontUnderline:!1,tickLineColor:"#ccc",tickLineWidth:.2,axisColor:"#000",axisWidth:1,rotation:0,offsetAdjust:{horizontal:0,vertical:0}},tooltip:{display:!0,text:"tooltip",fontType:"helvetica",fontSize:12,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontColor:"#fff",width:"auto",height:"auto"}},e=function(a){var f=this,g={},h=function(a){c={},c=b.clone(d),b.typeString(a)&&b.isSelector(a)?c.selector=a:b.typeObject(a)&&b.each(a,function(a,b){c[b]=a}),f=new e(c.selector,c)};if(b.existy(a))if(1===arguments.length){if(b.existy(b.getObjectBySelector(a))&&b.isSelector(a))return b.getObjectBySelector(a);c.selector===a&&b.truthy(c.selector)||h(a)}else arguments[0]===c.selector&&b.truthy(c.selector)?(f._options=b.clone(arguments[1]),b.setObjectOfSelector(a,f),f.setOptions(b.clone(arguments[1])).draw()):(g=arguments[1],g.selector=a,h(g));return f};return b.BarChart=e,e.prototype=Object.create(b.prototype),e.prototype.constructor=e,e.prototype.draw=function(){var a=this;return b.getLength(d3.select(a._options.selector))?(a.min().max().updateMin(),a._options.secondAxis&&a.min2().max2().updateMin2(),a.colors().drawChartSVG(),a.title().legend().tooltip().xLabel().yLabel().xAxis().yAxis(),void(a._options.secondAxis&&a.yLabel2().yAxis2())):void console.log("Please make sure the element exists in your template.")},e.prototype.unLoad=function(a){var c=this;return b.existy(a)&&"_dataset"===a&&(c._options._dataset=c._options._dataset2),c._options._dataset2=[],c._options._uniqueGroupArray2=[],c._options._uniqueGroupTmp2=[],c._options.secondAxis=!1,c.yLabel2().yAxis2().draw(),c},e.prototype._dataset=function(a){var c=this;return b.existy(a)&&b.typeString(a)&&"option"===a?c._options._dataset:(c.setOptions(arguments,"_dataset").draw(),c)},e.prototype.updateChartSize=function(a){var b,c,d=this;d._options.legend.position.indexOf("right")>=0&&d._options.secondAxis&&(d._options.padding.right=150),d._options._chartSVGWidth=d._options.width-d._options.padding.left-d._options.padding.right,d._options._chartSVGHeight=d._options.height-d._options.padding.top-d._options.padding.bottom;var e=d3.select(d._options.selector);return b=e.select("svg").empty()?e.append("svg"):e.select("svg"),b.attr("width",d._options.width).attr("height",d._options.height),c=b.select("g.bChart").empty()?b.append("g").attr("class","bChart"):b.select("g.bChart"),c.attr("width",d._options._chartSVGWidth).attr("height",d._options._chartSVGHeight).attr("transform","translate("+d._options.padding.left+","+d._options.padding.top+")"),d},e.prototype.drawChartSVG=function(){function a(){var a=d._options._dataset,b=d._options._uniqueGroupArrayAll,c=d.stackDataset(a,b,d._options._uniqueXArray),g=e.selectAll(".bChart_groupBar").data(c);g.exit().remove(),g.enter().append("g").attr("class",function(a,b){return"bChart_groupBar"});var h=g.selectAll("rect").data(function(a){return a});h.exit().remove(),h.enter().append("rect"),h.attr("width",f.rangeBand()-d._options.barDistance).attr("x",function(a){return f(a.x)+d._options.barDistance/2}).attr("y",d._options._chartSVGHeight).attr("height",0).style("fill",function(a){return d._options._colorMap[a.group]}).style("stroke",function(a,b){return d._options._colorMap[a.group]}).style("stroke-width",0).transition().duration(d._options.duration).attr("y",function(a){return i(a.y0+a.y)}).attr("height",function(a,b){return a.group===d._options._uniqueGroupArrayAll[0]?d._options._chartSVGHeight-i(a.y+a.y0):i(a.y0)-i(a.y+a.y0)}).attr("class",function(a){return"bChart_groups bChart_groups"+d._options._uniqueGroupArrayAll.indexOf(a.group)})}function c(){var a=d._options._dataset,c=d._options._uniqueGroupArrayAll,h=[];b.each(d._options._uniqueXArray,function(b,c){var d=a.filter(function(a){return a.x===b});h.push({x:b,data:d})});var j=e.selectAll(".bChart_groupBar").data(h);j.exit().remove(),j.enter().append("g").attr("class",function(a,b){return"bChart_groupBar"}),j.attr("transform",function(a){return"translate("+f(a.x)+",0)"});var l=j.selectAll("rect").data(function(a){return a.data});l.exit().transition().attr("height",0).remove(),l.enter().append("rect"),l.attr("width",g.rangeBand()-d._options.barDistance).attr("x",function(a,b){return g(a.group)+d._options.barDistance/2}).attr("y",d._options._chartSVGHeight).attr("height",0).style("fill",function(a,b){return d._options._colorMap[a.group]}).style("stroke",function(a,b){return d._options._colorMap[a.group]}).style("stroke-width",0).transition().duration(d._options.duration).attr("y",function(a){return a.secondAxis?k(a.value):i(a.value)}).attr("height",function(a){return a.secondAxis?d._options._chartSVGHeight-k(a.value):d._options._chartSVGHeight-i(a.value)}).attr("class",function(a){return"bChart_groups bChart_groups"+c.indexOf(a.group)})}var d=this;d.updateChartSize();var e=d3.select(d._options.selector).select("g.bChart"),f=d3.scale.ordinal().rangeRoundBands([0,d._options._chartSVGWidth],.1).domain(d._options._uniqueXArray),g=d3.scale.ordinal().rangeRoundBands([0,f.rangeBand()]).domain(d._options._uniqueGroupArrayAll);d._options.xAxis.tickSize=-d._options._chartSVGHeight,d._options.yAxis.tickSize=-d._options._chartSVGWidth;var h=d3.svg.axis().scale(f).orient(d._options.xAxis.orientation).ticks(d._options.xAxis.tickNumber).tickSize(d._options.xAxis.tickSize,0,0);e.select(".bChart_x_axis").empty()?e.append("g").attr("class","bChart_x_axis bChart_grid").attr("transform","translate(0,"+d._options._chartSVGHeight+")").call(h):e.select(".bChart_x_axis").transition().duration(d._options.duration).ease("sin-in-out").call(h);var i=d3.scale.linear().range([d._options._chartSVGHeight,0]).domain([d._options.minDefault,d._options.maxDefault]),j=d3.svg.axis().scale(i).orient(d._options.yAxis.orientation).tickFormat(d._options.yAxis.tickFormat).ticks(d._options.yAxis.tickNumber).tickSize(d._options.yAxis.tickSize,0,0);if(e.select(".bChart_y_axis").empty()?e.append("g").attr("class","bChart_y_axis bChart_grid").call(j):e.select(".bChart_y_axis").transition().duration(d._options.duration).ease("sin-in-out").call(j),d._options.secondAxis){var k=d3.scale.linear().range([d._options._chartSVGHeight,0]).domain([d._options.minDefault2,d._options.maxDefault2]),l=d3.svg.axis().scale(k).orient(d._options.yAxis2.orientation).tickFormat(d._options.yAxis2.tickFormat).ticks(d._options.yAxis2.tickNumber).tickSize(d._options.yAxis2.tickSize,0,0);e.select(".bChart_y_axis_2").empty()?e.append("g").attr("class","bChart_y_axis_2 bChart_grid").attr("transform","translate("+d._options._chartSVGWidth+",0)").call(l):e.select(".bChart_y_axis_2").attr("transform","translate("+d._options._chartSVGWidth+",0)").transition().duration(d._options.duration).ease("sin-in-out").call(l)}return d._options.isStack?a():c(),d},e.prototype.background=function(a){function c(){var a,c=d3.select(d._options.selector);a=c.select(".bChart_background").empty()?c.append("div").attr("class","bChart_background"):c.select(".bChart_background"),a.style("width",d._options.width+"px").style("height",d._options.height+"px"),d._options.background.displayImage?b.existy(d._options.background.imageURL)?a.style("background-image","url("+d._options.background.imageURL+")").style("opacity",d._options.background.opacity):d._options.background.displayImage=!1:a.style("background-image","none").style("background-color",d._options.background.color).style("opacity",d._options.background.opacity)}var d=this;return b.existy(a)&&b.typeString(a)&&"option"===a?d._options.background:(d.setOptions(arguments,"bChart_background"),c(),d)},e.prototype.title=function(a){function c(){var a,b=d3.select(d._options.selector).select("g.bChart");d._options.title.display?(a=b.select(".bChart_title").empty()?b.append("g").append("text").attr("class","bChart_title"):b.select(".bChart_title").style("display","block"),a.attr("x",d._options._chartSVGWidth/2+d._options.title.offsetAdjust.horizontal).attr("y",-d._options.padding.top+d._options.title.offsetAdjust.vertical+30).attr("text-anchor","middle").style("font-size",d._options.title.fontSize).style("font-family",d._options.title.fontType).style("fill",d._options.title.fontColor).style("text-decoration",function(){return d._options.title.fontUnderline?"underline":"none"}).style("font-weight",function(){return d._options.title.fontBold?"bold":"normal"}).style("font-style",function(){return d._options.title.fontItalic?"italic":"normal"}).text(d._options.title.text)):b.select(".bChart_title").style("display","none")}var d=this;return b.existy(a)&&b.typeString(a)&&"option"===a?d._options.title:(d.setOptions(arguments,"title"),c(),d)},e.prototype.legend=function(a){function c(){var a=[],c=d3.select(d._options.selector).select("g.bChart");if(d._options.legend.display){c.selectAll(".bChart_legend").empty()||c.selectAll(".bChart_legend").remove();var e,f,g,h,i,j=d._options._uniqueGroupArrayAll,k=c.selectAll(".bChart_legend").data(j).enter().append("g").attr("class","bChart_legend");switch(d._options.legend.position){case"topright":e=d._options._chartSVGWidth+d._options.padding.right+d._options.legend.offsetAdjust.horizontal-20,f=-60-d._options.legend.offsetAdjust.vertical,g=d._options._chartSVGWidth+d._options.padding.right+d._options.legend.offsetAdjust.horizontal-20-d._options.legend.offsetText,h=-56-d._options.legend.offsetAdjust.vertical,i="end";break;case"right":e=d._options._chartSVGWidth+d._options.padding.right+d._options.legend.offsetAdjust.horizontal-20,f=d._options._chartSVGHeight/2-d._options.legend.offsetAdjust.vertical-60,g=d._options._chartSVGWidth+d._options.padding.right+d._options.legend.offsetAdjust.horizontal-20-d._options.legend.offsetText,h=d._options._chartSVGHeight/2-d._options.legend.offsetAdjust.vertical-56,i="end";break;case"bottomright":e=d._options._chartSVGWidth+d._options.padding.right+d._options.legend.offsetAdjust.horizontal-20,f=d._options._chartSVGHeight+15-d._options.legend.offsetAdjust.vertical-60,g=d._options._chartSVGWidth+d._options.padding.right+d._options.legend.offsetAdjust.horizontal-20-d._options.legend.offsetText,h=d._options._chartSVGHeight+15-d._options.legend.offsetAdjust.vertical-56,i="end"}k.attr("transform",function(a,b){return"translate(0, "+b*d._options.legend.offsetSymbol+")"}).append("text").attr("x",g).attr("y",h).attr("dy",".35em").style("font-family",d._options.legend.fontType).style("text-decoration",function(){return d._options.legend.fontUnderline?"underline":"none"}).style("font-weight",function(){return d._options.legend.fontBold?"bold":"normal"}).style("font-style",function(){return d._options.legend.fontItalic?"italic":"normal"}).style("text-anchor",i).style("font-size",d._options.legend.fontSize).style("fill",d._options.legend.fontColor).text(function(a){return a}),k.append("rect").attr("x",e).attr("y",f).attr("width",d._options.legend.symbolSize).attr("height",d._options.legend.symbolSize).style("fill",function(a,b){return d._options._colorMap[a]}),k.on("mouseover",function(a){c.selectAll(".bChart_legend").classed("unhover",!0),c.selectAll(".bChart_groups").classed("unhover",!0),d3.select(this).classed("unhover",!1);var b=d._options._uniqueGroupArrayAll,e=b.indexOf(a),f=".bChart_groups"+e;c.selectAll(f).classed("unhover",!1)}).on("mouseout",function(a){c.selectAll(".bChart_legend").classed("unhover",!1),c.selectAll(".bChart_groups").classed("unhover",!1)}).on("click",function(e){var f=c.selectAll(".bChart_legend");a.length||(f.classed("inactive",!0),d._options._datasetTmp=d._options._dataset,d._options._uniqueGroupTmp=d._options._uniqueGroupArrayAll),b.isElementInArray(e,a)?(a.splice(b.getIndexOfElement(e,a),1),d3.select(this).classed("inactive",!0).classed("active",!1)):(a.push(e),d3.select(this).classed("inactive",!1).classed("active",!0)),d._options._uniqueGroupArrayAll=a,d._options._uniqueGroupArrayAll.sort(function(a,c){return b.getIndexOfElement(a,d._options._uniqueGroupTmp)-b.getIndexOfElement(c,d._options._uniqueGroupTmp)}),d._options.secondAxis=b.isOverlapArray(d._options._uniqueGroupArray2,a)||!a.length&&d._options._uniqueGroupArray2.length,a.length&&a.length!==d._options._uniqueGroupTmp.length||(f.classed("inactive",!1).classed("active",!1).classed("unhover",!1),d._options._uniqueGroupArrayAll=d._options._uniqueGroupTmp),d._updateDatasetBySelection(a),a.length===d._options._uniqueGroupTmp.length&&(a=[])})}else c.select(".legend").style("display","none")}var d=this;return b.existy(a)&&b.typeString(a)&&"option"===a?d._options.legend:(d.setOptions(arguments,"legend"),c(),d)},e.prototype._updateDatasetBySelection=function(a){var b=this,c=[];a.length?c=b._options._datasetTmp.filter(function(b,c){return a.indexOf(b.group)>=0}):(c=b._options._datasetTmp,b._options._datasetTmp=[],b._options._uniqueGroupTmp=[]),b.setOptions([c],"_dataset").min().max().yAxis2().updateMin().drawChartSVG().tooltip()},e.prototype.yLabel2=function(a){var c=this;if(!c._options.secondAxis){var d=d3.select(c._options.selector).select("g.bChart");return d.select(".bChart_ylabel_2").style("display","none"),c}return b.existy(a)&&b.typeString(a)&&"option"===a?c._options.yLabel2:(c.setOptions(arguments,"yLabel2"),c.yLabel("yLabel2"),c)},e.prototype.yLabel=function(a){function c(a){var c,e,f,g;c=b.existy(a)&&a?"yLabel2":"yLabel";var h=d3.select(d._options.selector).select("g.bChart");d._options[c].display?(g=b.existy(a)&&a?h.select(".bChart_ylabel_2").empty()?h.append("g").append("text").attr("class","bChart_ylabel_2"):h.select(".bChart_ylabel_2").style("display","block"):h.select(".bChart_ylabel").empty()?h.append("g").append("text").attr("class","bChart_ylabel"):h.select(".bChart_ylabel").style("display","block"),e=d._options._chartSVGHeight/2-d._options[c].offsetAdjust.vertical,f=b.existy(a)&&a?d._options.padding.left+d._options._chartSVGWidth+d._options[c].offsetAdjust.horizontal:-d._options.padding.left+25+d._options[c].offsetAdjust.horizontal,g.style("text-anchor","middle").style("fill",d._options[c].fontColor).attr("y",e).attr("x",f).attr("transform",function(a){return"rotate("+d._options[c].rotation+" "+f.toString()+" "+e.toString()+")"}).style("font-size",d._options[c].fontSize).style("font-family",d._options[c].fontType).style("text-decoration",function(){return d._options[c].fontUnderline?"underline":"none"}).style("font-weight",function(){return d._options[c].fontBold?"bold":"normal"}).style("font-style",function(){return d._options[c].fontItalic?"italic":"normal"}).text(d._options[c].text)):b.existy(a)&&a?h.select(".bChart_ylabel_2").style("display","none"):h.select(".bChart_ylabel").style("display","none")}var d=this;return b.existy(a)?b.typeString(a)&&"option"===a?d._options.yLabel:"yLabel2"!==a?(d.setOptions(arguments,"yLabel"),c(),d):void c(!0):(c(),d)},e.prototype.xLabel=function(a){function c(){var a,b,c,e=d3.select(d._options.selector).select("g.bChart");d._options.xLabel.display?(a=e.select(".bChart_xlabel").empty()?e.append("g").append("text").attr("class","bChart_xlabel"):e.select(".bChart_xlabel").style("display","block"),b=d._options._chartSVGWidth/2+d._options.xLabel.offsetAdjust.horizontal,c=d._options._chartSVGHeight+d._options.padding.bottom-10-d._options.xLabel.offsetAdjust.vertical,a.style("font-size",d._options.xLabel.fontSize).style("font-family",d._options.xLabel.fontType).style("fill",d._options.xLabel.fontColor).attr("x",b).attr("y",c).style("text-anchor","middle").style("text-decoration",function(){return d._options.xLabel.fontUnderline?"underline":"none"}).style("font-weight",function(){return d._options.xLabel.fontBold?"bold":"normal"}).style("font-style",function(){return d._options.xLabel.fontItalic?"italic":"normal"}).attr("transform",function(a){return"rotate("+d._options.xLabel.rotation+" "+b.toString()+" "+c.toString()+")"}).text(d._options.xLabel.text)):e.select(".bChart_xlabel").style("display","none")}var d=this;return b.existy(a)&&b.typeString(a)&&"option"===a?d._options.xLabel:(d.setOptions(arguments,"xLabel"),c(),d)},e.prototype.xAxis=function(a){function c(){var a=d3.select(d._options.selector).select("g.bChart"),b=a.select(".bChart_x_axis").selectAll("path"),c=a.select(".bChart_x_axis").selectAll("line"),e=a.select(".bChart_x_axis").selectAll("text");if(d._options.xAxis.display){b.style("stroke-width",d._options.xAxis.axisWidth).style("stroke",d._options.xAxis.axisColor).style("display","block"),e.style("display","block");var f,g,h;switch(d._options.xAxis.rotation){case-45:f="0",g="1em",h="end";break;case-90:f="-.5em",g="0",h="end";break;case 45:f="0em",g="1em",h="start";break;case 90:f=".5em",g="0",h="start";break;case 0:f="0",g="1em",h="middle"}e.style("text-anchor",h).attr("dx",f).attr("dy",g).attr("transfrom",function(a){return"rotate("+d._options.xAxis.rotation+")"}).style("font-size",d._options.xAxis.fontSize).style("fill",d._options.xAxis.fontColor).style("text-decoration",function(){return d._options.xAxis.fontUnderline?"underline":"none"}).style("font-weight",function(){return d._options.xAxis.fontBold?"bold":"normal"}).style("font-style",function(){return d._options.xAxis.fontItalic?"italic":"normal"}).style("font-family",d._options.xAxis.fontType)}else b.style("display","none"),e.style("display","none");d._options.xAxis.displayLine?c.style("stroke-width",d._options.xAxis.tickLineWidth).style("stroke",d._options.xAxis.tickLineColor).style("display","block"):c.style("display","none")}var d=this;return b.existy(a)&&b.typeString(a)&&"option"===a?d._options.xAxis:(d.setOptions(arguments,"xAxis"),c(),d)},e.prototype.yAxis2=function(a){var c=this;if(!c._options.secondAxis){var d=d3.select(c._options.selector).select("g.bChart");return d.select(".bChart_y_axis_2").style("display","none"),c}return b.existy(a)&&b.typeString(a)&&"option"===a?c._options.yAxis2:(c.setOptions(arguments,"yAxis2"),c.yAxis("yAxis2"),c)},e.prototype.yAxis=function(a){function c(a){var c,e,f,g,h,i,j,k=d3.select(d._options.selector).select("g.bChart");if(b.existy(a)&&a?(c="yAxis2",e=k.select(".bChart_y_axis_2"),f=k.select(".bChart_y_axis_2").selectAll("path"),g=k.select(".bChart_y_axis_2").selectAll("line"),h=k.select(".bChart_y_axis_2").selectAll("text"),i=d._options.minDefault2,j=d._options.maxDefault2):(c="yAxis",e=k.select(".bChart_y_axis"),f=k.select(".bChart_y_axis").selectAll("path"),g=k.select(".bChart_y_axis").selectAll("line"),h=k.select(".bChart_y_axis").selectAll("text"),i=d._options.minDefault,j=d._options.maxDefault),d._options[c].display){var l=d3.scale.linear().range([d._options._chartSVGHeight,0]).domain([i,j]),m=d3.svg.axis().scale(l).orient(d._options[c].orientation).tickFormat(d._options[c].tickFormat).ticks(d._options[c].tickNumber).tickSize(d._options[c].tickSize,0,0);e.transition().duration(d._options.duration).ease("sin-in-out").call(m),e.style("display","block"),f.style("stroke-width",d._options[c].axisWidth).style("stroke",d._options[c].axisColor).style("display","block"),h.style("display","block");var n,o,p;switch(d._options[c].rotation){case-45:a?(n=".1em",o="-1em",p="start"):(n="-.1em",o="-1em",p="end");break;case-90:a?(n="0.5em",o="-.5em",p="middle"):(n="0.5em",o="-.5em",p="middle");break;case 45:a?(n=".1em",o="1em",p="start"):(n=".1em",o="1em",p="end");break;case 90:a?(n="0em",o="1em",p="middle"):(n="0em",o="1em",p="middle");break;case 0:a?(n="0em",o="0.3em",p="start"):(n="0em",o="0.3em",p="end")}h.style("text-anchor",p).attr("dx",n).attr("dy",o).attr("transfrom",function(a){return"rotate("+d._options[c].rotation+")"}).style("font-size",d._options[c].fontSize).style("fill",d._options[c].fontColor).style("text-decoration",function(){return d._options[c].fontUnderline?"underline":"none"}).style("font-weight",function(){return d._options[c].fontBold?"bold":"normal"}).style("font-style",function(){return d._options[c].fontItalic?"italic":"normal"}).style("font-family",d._options[c].fontType)}else f.style("display","none"),h.style("display","none");d._options[c].displayLine?g.style("stroke-width",d._options[c].tickLineWidth).style("stroke",d._options[c].tickLineColor).style("display","block"):g.style("display","none")}var d=this;return b.existy(a)?b.typeString(a)&&"option"===a?d._options.yAxis:"yAxis2"!==a?(d.setOptions(arguments,"yAxis"),c(),d):void c(!0):(c(),d)},e.prototype.tooltip=function(a){function c(){var a,b=d3.select(d._options.selector);if(d._options.tooltip.display){a=b.select(".bChart_tooltip").empty()?b.append("div").attr("class","bChart_tooltip").style("opacity",0):b.select(".bChart_tooltip").style("opacity",0);var c=b.selectAll(".bChart_groupBar").selectAll("rect");c.on("mouseover",function(b){d3.select(this).style("opacity",.7),a.transition().duration(d._options.duration).style("opacity",1).style("display","block")}).on("mousemove",function(b){var c=b.group+"("+b.x+") :"+b.value,e=d3.select(this).style("fill"),f=d3.event.hasOwnProperty("offsetX")?d3.event.offsetX:d3.event.layerX,g=d3.event.hasOwnProperty("offsetY")?d3.event.offsetY:d3.event.layerY;a.style("background",e).style("top",g-10+"px").style("left",f+10+"px").style("font-family",d._options.tooltip.fontType).style("text-decoration",function(){return d._options.tooltip.fontUnderline?"underline":"none"}).style("font-weight",function(){return d._options.tooltip.fontBold?"bold":"normal"}).style("font-style",function(){return d._options.tooltip.fontItalic?"italic":"normal"}).style("font-size",d._options.tooltip.fontSize).style("color",d._options.tooltip.fontColor).html(c)}).on("mouseout",function(b){d3.select(this).style("opacity",1),a.transition().duration(d._options.duration).style("opacity",0).style("display","none")})}else a.remove()}var d=this;return b.existy(a)&&b.typeString(a)&&"option"===a?d._options.tooltip:(d.setOptions(arguments,"tooltip"),c(),d)},b});